<app-spinner filterBy="project/"></app-spinner>

<mat-dialog-content style="background: #fafbfe;">
  <ng-container *ngIf="project">
    <div class="row justify-content-center ">


      <div class="col-md-12 ">
        <form [formGroup]="projectForm" >

          <div class="form-row justify-content-center ">
            <div class="col-md-12 grid-margin stretch-card ">
              <div class="card ">
                <div class="card-body p-2">

                  <mat-form-field class="w-100">
                    <mat-label>{{'create.category_choose'|translate}}</mat-label>
                    <mat-select  [formControl]="categoryControl" required panelClass="category-panel" class="sss">
                      <mat-option *ngFor="let category of categories" [value]="category.id">
                        {{(translate.currentLang=='rus')?category.name_rus:(translate.currentLang=='eng')?category.name_eng:category.name_kz}}
                      </mat-option>
                    </mat-select>
                    <mat-error *ngIf="categoryControl.hasError('required')">{{'create.category_choose_error' | translate}}</mat-error>

                  </mat-form-field>
                </div></div></div>
            <div class="col-md-12 grid-margin stretch-card ">
              <div class="card">
                <div class="card-body p-2">
                  <div *ngFor="let lang of titleLangs">
                  <mat-form-field class="w-100" >
                    <mat-label>{{'project.update.create_name' | translate}} {{lang}}</mat-label>
                    <input matInput required [formControlName]="'title_' + lang" [placeholder]="(lang==='eng') ? 'Project name' : (lang==='rus') ? 'Название проекта' : 'Проекттың аты'" type="text" class="form-control" aria-label="Name" aria-describedby="inputGroup-sizing-definition">
                  </mat-form-field>
                  </div>
                </div></div></div>


            <div class="col-md-12 grid-margin stretch-card ">
              <div class="card">
                <div class="card-body p-2">
                  <div class="text-right">
                    <button [matMenuTriggerFor]="addLang" mat-icon-button  matTooltip="{{'create.description_add_info' | translate}}"
                            aria-label="Button that displays a tooltip when focused or hovered over">
                      <mat-icon>add</mat-icon>
                    </button>
                    <mat-menu #addLang="matMenu" xPosition="before">
                      <button mat-menu-item (click)="addDescription('rus')">Русский</button>
                      <button mat-menu-item (click)="addDescription('eng')">English</button>
                      <button mat-menu-item (click)="addDescription('kz')">Қазақша</button>
                    </mat-menu>
                  </div>
                  <mat-form-field *ngFor="let lang of descriptionLang;index as i" class="w-100" >
                    <mat-label>{{(lang=='eng')?'Brief description of the project':(lang=='rus')?'Краткое описание проекта':'Проекттың қысқа сипаттамасы'}}</mat-label>
                    <textarea [required]="i==0" formControlName="{{'description_' + lang}}" matInput
                    ></textarea>
                    <button *ngIf="i > 0" (click)="removeDescription(i)" matSuffix mat-icon-button  matTooltip="{{'create.description_remove_info' | translate}}"
                            aria-label="Button that displays a tooltip when focused or hovered over">
                      <mat-icon>remove_circle_outline</mat-icon>
                    </button>
                  </mat-form-field>
                </div></div></div>

            <div class="col-md-6 grid-margin stretch-card ">
              <div class="card">
                <div class="card-body p-2">
                  <mat-form-field class="w-100">
                    <mat-label>{{'create.deadline' | translate}}</mat-label>
                    <input formControlName="deadline" matInput [matDatepicker]="picker">
                    <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                    <mat-datepicker color="warn" #picker></mat-datepicker>
                  </mat-form-field>

                </div></div></div>

            <div class="col-md-6 grid-margin stretch-card ">
              <div class="card">
                <div class="card-body p-2">
                  <div class="input-group  ">
                    <div class="input-group-prepend">
                      <span class="input-group-text bg-sss text-white" id="inputGroup-sizing-def">{{'create.sum' | translate}}</span>
                    </div>
                    <input type="text" class="form-control" formControlName="goal" aria-label="Name" aria-describedby="inputGroup-sizing-def">
                  </div>
                </div></div></div>

            <div class="col-md-12 grid-margin stretch-card ">
              <div class="card">
                <div class="card-body p-2">
                  <div class="text-right">
                    <button [matMenuTriggerFor]="addLangContent" mat-icon-button  matTooltip="{{'create.content_add_info' | translate}}"
                            aria-label="Button that displays a tooltip when focused or hovered over">
                      <mat-icon>add</mat-icon>
                    </button>
                    <mat-menu #addLangContent="matMenu" xPosition="before">
                      <button mat-menu-item (click)="addContent('rus')">Русский</button>
                      <button mat-menu-item (click)="addContent('eng')">English</button>
                      <button mat-menu-item (click)="addContent('kz')">Қазақша</button>
                    </mat-menu>
                  </div>
                  <p>{{'create.content' | translate}}</p>
                  <div class="row justify-content-start mb-2" *ngFor="let lang of contentLangs; index as i">
                    <editor class="col-11"  formControlName="{{'content_' + lang}}" [required]="i==0"
                            apiKey="sj3n4ofpyw6lj5xkfeaedah9jf36wvm5wtrge3i8acvowjuy"
                            [init]="{
                    menubar: true,
                   image_uploadtab: true,
                   automatic_uploads: true,
                   images_upload_url: back +  '/api/v1/project/create/image',
                   language: (translate.currentLang === 'rus') ? 'ru' : (translate.currentLang === 'eng') ? 'en_CA':'kk',
                   plugins: [
                     'advlist autolink lists link image charmap print preview anchor ',
                     'searchreplace visualblocks code fullscreen',
                     'insertdatetime media table paste code help wordcount image'
                   ],
                   toolbar:
                     'undo redo | formatselect | bold italic backcolor | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | removeformat image | help'
                    }"
                            initialValue="vdava"
                    ></editor>
                    <button class="col-1" *ngIf="i > 0" (click)="removeContent(i)" matSuffix mat-icon-button  matTooltip="{{'create.content_remove_info'|translate}}"
                            aria-label="Button that displays a tooltip when focused or hovered over">
                      <mat-icon>remove_circle_outline</mat-icon>
                    </button>
                  </div>
                </div></div></div>


            <div class="col-md-6 grid-margin stretch-card ">
              <div class="card">
                <div class="card-body p-2">
                  <mat-form-field class="w-100">
                    <ngx-mat-file-input  (change)="ImageAddedEvent($event)"  multiple></ngx-mat-file-input>
                    <mat-icon matSuffix>insert_photo</mat-icon>
                  </mat-form-field>
                </div></div></div>

            <div class="col-md-6 grid-margin stretch-card ">
              <div class="card">
                <div class="card-body p-2">
                  <mat-form-field class="example-full-width" class=" w-100">
                    <mat-label>{{'create.video'|translate}}</mat-label>
                    <input  formControlName="video" matInput placeholder="https://www.youtube.com/watch?v=KK9bwTlAvgo">
                    <mat-icon matSuffix>videocam</mat-icon>
                    <mat-hint>{{'create.video_info' | translate}}</mat-hint>
                  </mat-form-field>
                </div></div></div>

            <div class="col-md-12 grid-margin stretch-card ">
              <div class="card">
                <div class="card-body p-2">
                  <p>{{'create.reward'|translate}}</p>
                  <form [formGroup]="rewardForm" (keydown)="addReward($event)">
                    <div class="form-row justify-content-center">
                      <mat-form-field class="w-50 pr-1" >
                        <mat-label>{{'create.reward_sum' |translate}}</mat-label>
                        <input formControlName="sum" matInput>
                      </mat-form-field>
                      <mat-form-field class="pl-1 w-50" >
                        <mat-label>{{'create.reward_description' | translate}}</mat-label>
                        <input formControlName="description" matInput>
                      </mat-form-field>


                    </div>
                  </form>

                  <div class="row justify-content-center">
                    <div class="col-md-9 grid-margin stretch-card ">
                      <div class="table-responsive">
                      <table class="table mt-md-3 ">
                        <thead>
                        <tr>
                          <th scope="col">#</th>
                          <th scope="col">{{'create.reward_table_sum'|translate}}</th>
                          <th scope="col">{{'create.reward_table_description'|translate}}</th>
                          <th scope="col">{{'create.reward_table_action'|translate}}</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr *ngFor="let gift of project.gifts; index as i">
                          <th scope="row">{{i + 1}}</th>
                          <td>{{gift.sum}}</td>
                          <td>{{gift.description}}</td>
                          <td>
                            <div class="row mt-md-2 text-center">
                              <div class=" d-flex ">
                                <button (click)="deleteReward(i)" mat-icon-button aria-label="Example icon button with a heart icon">
                                  <mat-icon>delete</mat-icon>
                                </button>

                              </div>

                            </div>
                        </tr>

                        </tbody>
                      </table>
                      </div>
                    </div>

                  </div>


                </div></div></div>

          </div>
        </form>

      </div>

    </div>
  </ng-container>
</mat-dialog-content>
<mat-dialog-actions align="end">
  <button class="btn btn-lg bg-sss text-light"e (click)="onSubmitProjectForm()">{{'save'|translate}}</button>

</mat-dialog-actions>
